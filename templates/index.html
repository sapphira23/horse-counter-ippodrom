<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–£—á—ë—Ç –ª–æ—à–∞–¥–µ–π –Ω–∞ –∏–ø–ø–æ–¥—Ä–æ–º–µ</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 900px; margin: 40px auto; padding: 20px; }
        .upload-area { border: 2px dashed #4CAF50; padding: 30px; text-align: center; margin: 20px 0; border-radius: 8px; }
        #result { margin-top: 30px; text-align: center; }
        .stats { background: #f5f5f5; padding: 15px; border-radius: 8px; margin-top: 20px; }
        button { background: #4CAF50; color: white; border: none; padding: 12px 24px; font-size: 16px; border-radius: 4px; cursor: pointer; }
        button:hover { background: #45a049; }
    </style>
</head>
<body>
    <h1>üêé –£—á—ë—Ç –ª–æ—à–∞–¥–µ–π –Ω–∞ –∏–ø–ø–æ–¥—Ä–æ–º–µ</h1>
    
    <div class="upload-area">
        <h3>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</h3>
        <input type="file" id="imageInput" accept="image/*">
        <button onclick="processImage()">–û–±—Ä–∞–±–æ—Ç–∞—Ç—å</button>
    </div>

    <div class="stats">
        <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
        <p>–í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: <span id="total">0</span></p>
        <p>–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <span id="lastCount">‚Äî</span> –ª–æ—à–∞–¥–µ–π</p>
        <button onclick="location.href='/report/pdf'">–°–∫–∞—á–∞—Ç—å PDF-–æ—Ç—á—ë—Ç</button>
        <button onclick="location.href='/report/excel'">–°–∫–∞—á–∞—Ç—å Excel-–æ—Ç—á—ë—Ç</button>
    </div>

    <div id="result"></div>

    <script>
        async function processImage() {
            const fileInput = document.getElementById('imageInput');
            const file = fileInput.files[0];
            if (!file) return alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª!');
            
            const formData = new FormData();
            formData.append('file', file);
            formData.append('type', 'image');
            
            const res = await fetch('/process', {
                method: 'POST',
                body: formData
            });
            const data = await res.json();
            
            if (data.success) {
                document.getElementById('result').innerHTML = `
                    <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
                    <p>–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –ª–æ—à–∞–¥–µ–π: <strong>${data.horse_count}</strong></p>
                    <img src="${data.result_url}" style="max-width: 100%; border: 1px solid #ddd; border-radius: 4px;">
                `;
                document.getElementById('lastCount').textContent = data.horse_count;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                const history = await fetch('/history').then(r => r.json());
                document.getElementById('total').textContent = history.length;
            } else {
                alert('–û—à–∏–±–∫–∞: ' + data.error);
            }
        }
    </script>
</body>
</html>